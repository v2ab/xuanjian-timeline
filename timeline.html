<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>家族历史时间线</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@300;400;700&family=Noto+Sans+SC:wght@300;400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* 重置与基础样式 */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Noto Sans SC', sans-serif;
      background: linear-gradient(135deg, #f5f7fa, #e4e9f0);
      color: #333;
      padding: 20px;
      line-height: 1.6;
    }
    h2 {
      font-family: 'Noto Serif SC', serif;
      text-align: center;
      margin-bottom: 20px;
      font-size: 32px;
      font-weight: 700;
      color: #2c3e50;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }
    .toggle-buttons {
      text-align: center;
      margin-bottom: 30px;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
    }
    .toggle-buttons button {
      background: #3498db;
      color: #fff;
      border: none;
      padding: 10px 15px;
      border-radius: 30px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 500;
      transition: all 0.3s ease;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      min-width: 120px;
    }
    .toggle-buttons button:hover { 
      background: #2980b9; 
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    .toggle-buttons button:active {
      transform: translateY(0);
    }
    /* 时间线容器 */
    .timeline-container {
      position: relative;
      max-width: 900px;
      margin: 0 auto;
    }
    /* 垂直时间轴线 */
    .timeline-container::before {
      content: '';
      position: absolute;
      top: 0;
      bottom: 0;
      left: 120px;
      width: 4px;
      background: linear-gradient(to bottom, #3498db, #9b59b6);
      border-radius: 2px;
    }
    /* 每个事件项：左右分区 */
    .timeline-event {
      display: flex;
      position: relative;
      margin-bottom: 15px;
    }
    /* 左侧时间标记区域 */
    .time-marker {
      width: 200px;
      text-align: right;
      padding-right: 25px;
      position: relative;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: flex-end;
    }
    .time-marker .icon-container {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      background: #fff;
      border-radius: 50%;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
      position: relative;
      z-index: 2;
    }
    .time-marker:hover .icon-container {
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .time-marker i {
      font-size: 20px;
      transition: all 0.3s ease;
    }
    .time-marker .time-text {
      font-family: 'Noto Serif SC', serif;
      font-size: 18px;
      font-weight: 700;
      color: #34495e;
      margin-right: 15px;
      transition: color 0.3s ease;
    }
    .time-marker:hover .time-text {
      color: #2980b9;
    }
    /* 图标颜色 */
    .timeline-event[data-type="big"] .icon-container i {
      color: #e74c3c;
    }
    .timeline-event[data-type="medium"] .icon-container i {
      color: #f39c12;
    }
    .timeline-event[data-type="small"] .icon-container i {
      color: #27ae60;
    }
    /* 右侧事件卡片 */
    .event-card {
      background: #fff;
      padding: 20px 25px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.08);
      flex: 1;
      position: relative;
      transition: all 0.4s ease;
      overflow: hidden;
      transform-origin: left center;
    }
    .event-card.hidden {
      max-height: 0;
      opacity: 0;
      padding-top: 0;
      padding-bottom: 0;
      transform: scaleY(0);
    }
    .event-card .title {
      font-family: 'Noto Serif SC', serif;
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 12px;
      color: #2c3e50;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .event-card .description {
      font-size: 16px;
      line-height: 1.7;
      color: #555;
      margin-bottom: 15px;
    }
    /* 家族人物按钮和列表 */
    .family-members-btn {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 30px;
      padding: 8px 15px;
      font-size: 14px;
      color: #495057;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .family-members-btn:hover {
      background: #e9ecef;
      color: #212529;
    }
    .family-members-btn i {
      font-size: 14px;
    }
    .family-members-list {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 15px;
      margin-top: 15px;
      display: none;
    }
    .family-members-list.active {
      display: block;
    }
    .family-member {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      border-bottom: 1px solid #e9ecef;
      transition: background 0.2s;
    }
    .family-member:last-child {
      border-bottom: none;
    }
    .family-member:hover {
      background: #e9ecef;
      border-radius: 6px;
    }
    .member-info {
      display: flex;
      flex-direction: column;
    }
    .member-name {
      font-weight: 700;
      font-size: 16px;
      color: #343a40;
    }
    .member-years {
      font-size: 14px;
      color: #6c757d;
    }
    .member-description {
      font-size: 14px;
      color: #6c757d;
      max-width: 400px;
    }
    .member-age {
      font-weight: 700;
      font-size: 16px;
      color: #3498db;
      background: #e3f2fd;
      padding: 4px 10px;
      border-radius: 15px;
    }
    /* 时间间隔的gap处理 */
    .gap {
      position: relative;
      width: 100%;
    }
    .gap .line {
      position: absolute;
      left: 120px;
      width: 4px;
      background: linear-gradient(to bottom, #3498db, #9b59b6);
      border-radius: 2px;
    }
    .gap .break-indicator {
      position: absolute;
      left: 120px;
      top: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(135deg, #ff9a9e, #fad0c4);
      padding: 8px;
      border-radius: 50%;
      box-shadow: 0 4px 12px rgba(255,150,150,0.3);
      z-index: 3;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }
    .gap:hover .break-indicator {
      transform: translate(-50%, -50%) scale(1.1);
      box-shadow: 0 6px 15px rgba(255,150,150,0.4);
    }
    .gap .break-indicator i {
      color: white;
      font-size: 14px;
    }
    .time-jump-label {
      position: absolute;
      left: 145px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 11px;
      background: rgba(255,255,255,0.9);
      padding: 3px 8px;
      border-radius: 10px;
      color: #e74c3c;
      white-space: nowrap;
      font-weight: 500;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 2;
    }
    .gap:hover .time-jump-label {
      opacity: 1;
    }
    /* 响应式设计 */
    @media (max-width: 768px) {
      .timeline-container::before { left: 80px; }
      .time-marker { 
        width: 140px; 
        padding-right: 15px; 
      }
      .time-marker .time-text { 
        font-size: 16px; 
        margin-right: 10px;
      }
      .time-marker .icon-container {
        width: 36px;
        height: 36px;
      }
      .time-marker i {
        font-size: 18px;
      }
      .gap .line { left: 80px; }
      .gap .break-indicator { left: 80px; }
      .time-jump-label { left: 105px; }
      .event-card .title {
        font-size: 18px;
      }
      .event-card .description {
        font-size: 14px;
      }
      .member-description {
        max-width: 250px;
      }
    }
    @media (max-width: 576px) {
      body {
        padding: 15px 10px;
      }
      h2 {
        font-size: 24px;
      }
      .timeline-container::before { left: 60px; }
      .time-marker { 
        width: 110px; 
        padding-right: 10px; 
      }
      .time-marker .time-text { 
        font-size: 14px; 
        margin-right: 8px;
      }
      .time-marker .icon-container {
        width: 32px;
        height: 32px;
      }
      .time-marker i {
        font-size: 16px;
      }
      .gap .line { left: 60px; }
      .gap .break-indicator { left: 60px; }
      .time-jump-label { left: 85px; }
      .event-card {
        padding: 15px;
      }
      .event-card .title {
        font-size: 16px;
      }
      .event-card .description {
        font-size: 13px;
      }
      .family-members-btn {
        font-size: 12px;
        padding: 6px 12px;
      }
      .member-name {
        font-size: 14px;
      }
      .member-years, .member-description, .member-age {
        font-size: 12px;
      }
      .member-description {
        max-width: 150px;
      }
    }
    /* 时间标尺样式 */
    .time-ruler {
      position: absolute;
      left: 0;
      width: 100%;
      z-index: 1;
      pointer-events: none;
      height: 100%;
    }
    .ruler-mark {
      position: absolute;
      display: flex;
      align-items: center;
      left: 120px;
      transform: translateX(-50%);
    }
    .ruler-mark::before {
      content: '';
      width: 8px;
      height: 1px;
      background-color: rgba(0,0,0,0.2);
    }
    .ruler-year {
      font-size: 10px;
      color: rgba(0,0,0,0.3);
      margin-left: 4px;
      font-family: 'Noto Sans SC', sans-serif;
      font-weight: 300;
    }
  </style>
</head>
<body>
  <h2>家族历史时间线</h2>
  <div class="toggle-buttons">
    <button id="toggleBig">切换重大事件</button>
    <button id="toggleMedium">切换中等事件</button>
    <button id="toggleSmall">切换小型事件</button>
    <button id="toggleAll">全部展开/折叠</button>
  </div>
  <div class="timeline-container" id="timelineContainer"></div>
  
  <script>
    // 图标映射，使用FontAwesome图标
    const icons = {
      big: {
        expanded: '<i class="fas fa-star"></i>',
        collapsed: '<i class="far fa-star"></i>'
      },
      medium: {
        expanded: '<i class="fas fa-bookmark"></i>',
        collapsed: '<i class="far fa-bookmark"></i>'
      },
      small: {
        expanded: '<i class="fas fa-circle"></i>',
        collapsed: '<i class="far fa-circle"></i>'
      }
    };

    // 示例事件数据
    let events = [
      { year: 1800, label: "家族创立", description: "家族的起源，在小村庄中萌芽。", type: "big" },
      { year: 1805, label: "早期发展", description: "家族开始在本地区小有名气。", type: "small" },
      { year: 1810, label: "地区扩张", description: "家族影响力逐渐扩大。", type: "medium" },
      { year: 1850, label: "迁移至新大陆", description: "为追求更好的生活，家族大举移民新大陆。", type: "big" },
      { year: 1860, label: "建立小作坊", description: "家族在新大陆建立了第一家作坊。", type: "small" },
      { year: 1900, label: "成立企业", description: "家族创立了现代企业，迈入工业时代。", type: "big" },
      { year: 1905, label: "技术革新", description: "企业进行了重大技术革新。", type: "medium" },
      { year: 1950, label: "家族改革", description: "面对时代变革，家族进行了深层次改革。", type: "big" },
      { year: 2000, label: "全球扩张", description: "家族企业进入全球市场，实现跨国经营。", type: "big" }
    ];
    
    // 家族人物数据
    let familyMembers = [
      { id: 1, name: "张远山", birthYear: 1780, deathYear: 1860, description: "家族创始人，具有远见卓识" },
      { id: 2, name: "张明德", birthYear: 1800, deathYear: 1875, description: "第二代族长，带领家族走向繁荣" },
      { id: 3, name: "张立业", birthYear: 1830, deathYear: 1905, description: "企业家，家族企业创始人" },
      { id: 4, name: "张世华", birthYear: 1860, deathYear: 1940, description: "工业革命时期的领导者" },
      { id: 5, name: "张天明", birthYear: 1890, deathYear: 1980, description: "现代企业管理的奠基人" },
      { id: 6, name: "张志远", birthYear: 1920, deathYear: 2005, description: "家族改革的主要推动者" },
      { id: 7, name: "张沛然", birthYear: 1950, deathYear: null, description: "全球化战略的制定者" },
      { id: 8, name: "张明轩", birthYear: 1975, deathYear: null, description: "现任家族企业CEO" }
    ];
    
    // 按年份排序
    events.sort((a, b) => a.year - b.year);
    
    const timelineContainer = document.getElementById('timelineContainer');
    const eventElements = [];  // 用于存储各事件DOM，便于批量操作
    
    // 默认状态：大事件展开，其它折叠
    function getDefaultState(type) {
      return type === "big";
    }
    
    // 清空 timelineContainer
    timelineContainer.innerHTML = "";
    
    // 设置时间间隔的参数
    const scale = 5;          // 每年对应5px
    const gapThreshold = 30;  // 超过30年的间隔，将折断
    const maxGapHeight = 150; // 折断后最大间隔高度
    const rulerStep = 5;      // 每5年一个标尺刻度
    
    // 计算人物在某一年的年龄
    function calculateAge(member, year) {
      if (member.birthYear > year) return null; // 未出生
      if (member.deathYear && member.deathYear < year) return null; // 已去世
      
      return year - member.birthYear;
    }
    
    // 生成人物列表HTML
    function generateMembersListHTML(year) {
      let html = '<div class="family-members-list">';
      let hasLivingMembers = false;
      
      familyMembers.forEach(member => {
        const age = calculateAge(member, year);
        if (age !== null) {
          hasLivingMembers = true;
          html += `
            <div class="family-member">
              <div class="member-info">
                <span class="member-name">${member.name}</span>
                <span class="member-years">${member.birthYear} - ${member.deathYear || '至今'}</span>
                <span class="member-description">${member.description}</span>
              </div>
              <span class="member-age">${age}岁</span>
            </div>
          `;
        }
      });
      
      if (!hasLivingMembers) {
        html += '<div style="text-align: center; padding: 10px; color: #6c757d;">此时期无在世家族成员</div>';
      }
      
      html += '</div>';
      return html;
    }
    
    // 遍历事件，生成 DOM
    events.forEach((event, index) => {
      // 创建事件行容器
      const eventRow = document.createElement('div');
      eventRow.classList.add('timeline-event');
      eventRow.dataset.type = event.type;
      eventRow.dataset.expanded = getDefaultState(event.type);
      
      // 创建左侧时间标记
      const timeMarker = document.createElement('div');
      timeMarker.classList.add('time-marker');
      const expanded = getDefaultState(event.type);
      const iconHtml = expanded ? icons[event.type].expanded : icons[event.type].collapsed;
      
      timeMarker.innerHTML = `
        <span class="time-text">${event.year}</span>
        <div class="icon-container">${iconHtml}</div>
      `;
      
      // 点击图标切换展开/折叠
      timeMarker.addEventListener('click', function() {
        const currentState = eventRow.dataset.expanded === "true";
        eventRow.dataset.expanded = (!currentState).toString();
        updateEventDisplay(eventRow, event.type);
      });
      
      // 创建右侧事件卡片
      const eventCard = document.createElement('div');
      eventCard.classList.add('event-card');
      if (!getDefaultState(event.type)) {
        eventCard.classList.add('hidden');
      }
      
      // 添加家族成员按钮和列表
      const familyMembersBtn = `
        <button class="family-members-btn">
          <i class="fas fa-users"></i> 家族成员
        </button>
      `;
      
      eventCard.innerHTML = `
        <div class="title">
          ${event.label}
          ${familyMembersBtn}
        </div>
        <div class="description">${event.description}</div>
        ${generateMembersListHTML(event.year)}
      `;
      
      eventRow.appendChild(timeMarker);
      eventRow.appendChild(eventCard);
      
      // 存储以便后续批量操作
      eventElements.push({ element: eventRow, type: event.type });
      timelineContainer.appendChild(eventRow);
      
      // 添加事件与下一事件之间的间隔（若不是最后一个）
      if (index < events.length - 1) {
        const nextEvent = events[index + 1];
        const yearDiff = nextEvent.year - event.year;
        const gapDiv = document.createElement('div');
        gapDiv.classList.add('gap');
        let gapHeight = yearDiff * scale;
        let showBreak = false;
        if (yearDiff > gapThreshold) {
          gapHeight = maxGapHeight;
          showBreak = true;
        }
        gapDiv.style.height = gapHeight + 'px';
        // 连接线
        const lineDiv = document.createElement('div');
        lineDiv.classList.add('line');
        lineDiv.style.height = gapHeight + 'px';
        gapDiv.appendChild(lineDiv);
        // 如果间隔太长，显示折断标识
        if (showBreak) {
          const breakIndicator = document.createElement('div');
          breakIndicator.classList.add('break-indicator');
          breakIndicator.innerHTML = '<i class="fas fa-clock"></i>';
          
          // 添加时间跳跃文本标签
          const jumpLabel = document.createElement('div');
          jumpLabel.classList.add('time-jump-label');
          const yearText = yearDiff > 99 ? '超过一个世纪' : `${yearDiff} 年`;
          jumpLabel.textContent = `时间跳跃 ${yearText}`;
          
          gapDiv.appendChild(breakIndicator);
          gapDiv.appendChild(jumpLabel);
        }
        timelineContainer.appendChild(gapDiv);
      }
    });
    
    // 更新单个事件的显示状态及图标
    function updateEventDisplay(eventRow, type) {
      const expanded = eventRow.dataset.expanded === "true";
      const iconContainer = eventRow.querySelector('.icon-container');
      const eventCard = eventRow.querySelector('.event-card');
      const iconHtml = expanded ? icons[type].expanded : icons[type].collapsed;
      iconContainer.innerHTML = iconHtml;
      if (expanded) {
        eventCard.classList.remove('hidden');
      } else {
        eventCard.classList.add('hidden');
      }
    }
    
    // 批量切换：根据事件类型，切换所有同类事件
    function toggleAllByType(type) {
      const items = eventElements.filter(item => item.type === type);
      // 如果所有该类型事件都展开，则全部折叠；否则全部展开
      const allExpanded = items.every(item => item.element.dataset.expanded === "true");
      items.forEach(item => {
        item.element.dataset.expanded = (!allExpanded).toString();
        updateEventDisplay(item.element, type);
      });
    }
    
    // 绑定顶部按钮的批量切换功能
    document.getElementById('toggleBig').addEventListener('click', function() {
      toggleAllByType("big");
    });
    document.getElementById('toggleMedium').addEventListener('click', function() {
      toggleAllByType("medium");
    });
    document.getElementById('toggleSmall').addEventListener('click', function() {
      toggleAllByType("small");
    });
    
    // 全部展开/折叠功能
    document.getElementById('toggleAll').addEventListener('click', function() {
      const allExpanded = eventElements.every(item => item.element.dataset.expanded === "true");
      eventElements.forEach(item => {
        item.element.dataset.expanded = (!allExpanded).toString();
        updateEventDisplay(item.element, item.type);
      });
    });
    
    // 添加家族成员按钮点击事件（事件委托）
    document.addEventListener('click', function(e) {
      if (e.target.closest('.family-members-btn')) {
        const btn = e.target.closest('.family-members-btn');
        const eventCard = btn.closest('.event-card');
        const membersList = eventCard.querySelector('.family-members-list');
        membersList.classList.toggle('active');
        
        // 更新按钮图标
        const icon = btn.querySelector('i');
        if (membersList.classList.contains('active')) {
          icon.className = 'fas fa-users-slash';
          btn.innerHTML = '<i class="fas fa-users-slash"></i> 隐藏成员';
        } else {
          icon.className = 'fas fa-users';
          btn.innerHTML = '<i class="fas fa-users"></i> 家族成员';
        }
      }
    });
    
    // 生成时间标尺
    function generateTimeRuler() {
      // 找出最早和最晚年份
      const minYear = Math.min(...events.map(e => e.year));
      const maxYear = Math.max(...events.map(e => e.year));
      
      // 计算标尺起始年份（向下取整到最接近的5的倍数）
      const startYear = Math.floor(minYear / rulerStep) * rulerStep;
      // 计算标尺结束年份（向上取整到最接近的5的倍数）
      const endYear = Math.ceil(maxYear / rulerStep) * rulerStep;
      
      // 创建标尺容器
      const rulerContainer = document.createElement('div');
      rulerContainer.classList.add('time-ruler');
      
      // 储存事件年份和位置的映射
      const yearPositions = new Map();
      
      // 首先将所有事件的年份和位置加入映射
      events.forEach((event, index) => {
        const eventElement = eventElements[index].element;
        const rect = eventElement.getBoundingClientRect();
        const timelineRect = timelineContainer.getBoundingClientRect();
        yearPositions.set(event.year, rect.top - timelineRect.top + 20); // 20px offset为标题中心位置
      });
      
      // 生成标尺刻度
      let currentY = 0;
      for (let year = startYear; year <= endYear; year += rulerStep) {
        // 如果是事件年份，使用事件的位置
        if (yearPositions.has(year)) {
          currentY = yearPositions.get(year);
        } else {
          // 找到最近的两个年份
          const years = Array.from(yearPositions.keys()).sort((a, b) => a - b);
          const prevYear = years.filter(y => y < year).pop();
          const nextYear = years.find(y => y > year);
          
          // 如果没有前一年或后一年，跳过（只标注事件发生的年份及其之间的规则刻度）
          if (!prevYear || !nextYear) continue;
          
          // 如果年份之间的跨度超过阈值，跳过（这是时间跳跃区间）
          if (nextYear - prevYear > gapThreshold) continue;
          
          // 在相邻事件之间使用线性插值计算位置
          const progress = (year - prevYear) / (nextYear - prevYear);
          const prevY = yearPositions.get(prevYear);
          const nextY = yearPositions.get(nextYear);
          currentY = prevY + progress * (nextY - prevY);
        }
        
        // 创建标尺刻度
        const mark = document.createElement('div');
        mark.classList.add('ruler-mark');
        mark.style.top = `${currentY}px`;
        
        // 添加年份文本
        const yearText = document.createElement('span');
        yearText.classList.add('ruler-year');
        yearText.textContent = year;
        
        mark.appendChild(yearText);
        rulerContainer.appendChild(mark);
      }
      
      // 将标尺添加到时间线容器
      timelineContainer.prepend(rulerContainer);
    }
    
    // 页面完全加载后生成时间标尺
    window.addEventListener('load', function() {
      generateTimeRuler();
    });
  </script>
</body>
</html>
